# MatchMaker service
Сервис для формирования группы игроков

## Параметры  
service.matchmaker.groupSize -  количество игроков для формирования одной группы  
service.matchmaker.minBalancePercent - минимальное значение баланса в команде в процентном значении  
service.matchmaker.groupFormLatencySec - допустимая задержка по времени для формирования группы (сек.)  
service.matchmaker.formGroupDelay - время в секундах через которое запускается формирование группы  

## Логика работы сервиса  
Значение баланса в команде рассчитвается исходя из относительного стандартного отклонения по параметру user.skill  
Через каждый промежуток времени == formGroupDelay запускаем формирование группы  
Если количество игроков в очереди >= groupSize пробуем сформировать группу  

Предполагаем, что параметр groupFormLatency приоритетнее minBalancePercent

### При запуске формирования группы:
	если размер очереди < groupSize - ждем еще игроков
	если размер очереди >= groupSize && время формирования группы < groupFormLatency && баланс группы < minBalancePercent  - запускаем перебалансировку
	если размер очереди >= groupSize && время формирования группы < groupFormLatency && баланс группы >= minBalancePercent  - запускаем формирование группы
	если размер очереди >= groupSize && время формирования группы > groupFormLatency - запускаем формирование группы
	
	
### Перебалансировка
	Балансируем по user.latancy
	1. Находим в группе игрока с наибольшей задержкой 
	2. Сравниваем задержки новых игроков в очереди и игрока с наибольшей задержкой
	3. Если у нового игрока задержка меньше - меняем
	4. Игрока которого поменяли возвращаем в очередь
	
	Балансируем по user.skill (увеличиваем плотность группы)
	1. Сортируем список игроков группы по user.skill
	1. Итерируемся по отсортированному списку игроков группы и вычисляем наибольшую разницу между соседними элементами
	2. Находим в очереди игрока, с которым разница параметров user.skill положительна и минимальна
	3. Меняем игроков в группе
	4. Игрока которого поменяли возвращаем в очередь
